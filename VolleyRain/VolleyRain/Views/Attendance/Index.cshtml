@model VolleyRain.Models.AttendanceMatrix

@{
    ViewBag.Title = "Anwesenheitskontrolle";
    var pagination = ViewBag.Pagination as VolleyRain.Models.Pagination;
}

<h2>Anwesenheitskontrolle <small>Team SVKT Rain</small></h2>

<div class="pager">
    @Html.PreviousPageButton(pagination, "Zurück")
    @Html.NextPageButton(pagination, "Weiter")
    <a href="@Url.Action("Edit")" class="btn btn-success">Bearbeiten</a>
</div>

<table class="table table-condensed">
    <thead>
        <tr>
            <th></th>

            @foreach (var item in Model.Events) { 
            
                <th class="@item.GetCssClass()">@Html.FormatValue(item.Start, "{0:ddd, dd.MM. HH:mm}")</th>
                
            }

        </tr>
    </thead>

    @foreach (var user in Model.Users) { 
    
        <tr>

            <td>@Html.DisplayFor(model => user.DisplayName)</td>

            @foreach (var item in Model.Events) {

                var attendance = Model.GetAttendanceFor(user, item);
                var tdBuilder = new TagBuilder("td");
                if (attendance != null)
                {
                    tdBuilder.MergeAttribute("class", attendance.GetCssClass());
                    var divBuilder = new TagBuilder("div");
                    if (attendance.HasComment)
                    {
                        divBuilder.MergeAttribute("class", "with-comment");
                        divBuilder.MergeAttribute("data-toggle", "tooltip");
                        divBuilder.MergeAttribute("title", attendance.Comment);
                    }
                    divBuilder.SetInnerText(attendance.TypeName);
                    tdBuilder.InnerHtml = divBuilder.ToString();
                }
                @Html.Raw(tdBuilder.ToString());
            }

        </tr>
        
    }

    <tfoot>
        <tr>
            <th></th>

            @foreach (var item in Model.Events) { 
            
                <th>@Model.GetAttendeesFor(item)</th>
                
            }

        </tr>
    </tfoot>

</table>

<script>
    $(function () {
        $('.with-comment').tooltip();
    });
</script>